<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Menu Management - BeanBox CafÃ© Admin</title>
  <link rel="stylesheet" href="../css/admin.css">
</head>
<body>
  <div class="admin-container">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">â˜•</div>
        <h2>BeanBox Admin</h2>
        <p class="admin-email" id="adminEmail"></p>
      </div>
      
      <nav class="sidebar-nav">
        <a href="dashboard.html" class="nav-item">
          <span class="nav-icon">ğŸ“Š</span>
          <span class="nav-text">Dashboard</span>
        </a>
        <a href="analytics.html" class="nav-item">
          <span class="nav-icon">ğŸ“ˆ</span>
          <span class="nav-text">Analytics</span>
        </a>
        <a href="menu.html" class="nav-item active">
          <span class="nav-icon">ğŸ“‹</span>
          <span class="nav-text">Menu</span>
        </a>
        <a href="live-orders.html" class="nav-item">
          <span class="nav-icon">ğŸ””</span>
          <span class="nav-text">Live Orders</span>
        </a>
        <a href="completed.html" class="nav-item">
          <span class="nav-icon">âœ…</span>
          <span class="nav-text">Completed</span>
        </a>
        <a href="walk-in.html" class="nav-item">
          <span class="nav-icon">ğŸš¶</span>
          <span class="nav-text">Walk-in Order</span>
        </a>
        <a href="#" class="nav-item nav-logout" onclick="handleLogout()">
          <span class="nav-icon">ğŸšª</span>
          <span class="nav-text">Logout</span>
        </a>
      </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <header class="top-header">
        <button class="menu-toggle" id="menuToggle">â˜°</button>
        <h1>Menu Management</h1>
        <div class="header-actions">
          <button class="btn btn-primary btn-sm" onclick="openAddModal()">
            â• Add Item
          </button>
          <span class="current-time" id="currentTime"></span>
        </div>
      </header>
      
      <div class="content-area">
        <!-- Search Bar -->
        <div class="search-bar">
          <input 
            type="text" 
            id="searchInput" 
            class="search-input" 
            placeholder="ğŸ” Search menu items..."
            oninput="filterMenu()"
          >
        </div>
        
        <!-- Menu List -->
        <div id="menuList" class="menu-list">
          <div class="loading">Loading menu...</div>
        </div>
      </div>
    </main>
  </div>

  <!-- Add/Edit Modal -->
  <div class="modal" id="menuModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="modalTitle">Add Menu Item</h3>
        <button class="modal-close" onclick="closeModal()">Ã—</button>
      </div>
      <div class="modal-body">
        <form id="menuForm" onsubmit="saveMenuItem(event)">
          <input type="hidden" id="itemId">
          
          <div class="form-group">
            <label>Item Name *</label>
            <input type="text" id="itemName" class="form-input" required>
          </div>
          
          <div class="form-group">
            <label>Category *</label>
            <select id="itemCategory" class="form-select" required>
              <option value="">Select Category</option>
              <option value="Coffee">Coffee</option>
              <option value="Snacks">Snacks</option>
              <option value="Desserts">Desserts</option>
              <option value="Drinks">Drinks</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Price (â‚¹) *</label>
            <input type="number" id="itemPrice" class="form-input" min="0" step="1" required>
          </div>
          
          <div class="form-group">
            <label>Description</label>
            <input type="text" id="itemDescription" class="form-input">
          </div>
          
          <div class="form-group">
            <label>Type *</label>
            <select id="itemType" class="form-select" required>
              <option value="veg">Veg</option>
              <option value="nonveg">Non-Veg</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>In Stock</label>
            <select id="itemInStock" class="form-select">
              <option value="true">Yes</option>
              <option value="false">No</option>
            </select>
          </div>
          
          <div class="form-group">
            <label>Image URL</label>
            <input type="text" id="itemImage" class="form-input" placeholder="https://...">
          </div>
          
          <div class="modal-actions">
            <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Item</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="../js/utils.js"></script>
  <script src="../js/admin-common.js"></script>
  <script>
    let menuItems = [];
    let editingItemId = null;

    // Load menu items
    async function loadMenu() {
      try {
        menuItems = await apiCall('/menu');
        displayMenu(menuItems);
      } catch (error) {
        console.error('Error loading menu:', error);
        document.getElementById('menuList').innerHTML = 
          '<div class="empty-state">Failed to load menu</div>';
      }
    }

    // Display menu items
    function displayMenu(items) {
      const container = document.getElementById('menuList');
      
      if (items.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div style="font-size: 80px; margin-bottom: 20px;">ğŸ“‹</div>
            <h3>No Menu Items</h3>
            <p>Add your first menu item to get started</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = items.map(item => `
        <div class="menu-card">
          ${item.image ? `<img src="${item.image}" alt="${item.name}" class="menu-card-image" onerror="this.src='https://via.placeholder.com/300x180/7B2CBF/FFFFFF?text=No+Image'">` : 
            `<div class="menu-card-image" style="background: linear-gradient(135deg, #7B2CBF 0%, #9D4EDD 100%); display: flex; align-items: center; justify-content: center; color: white; font-size: 48px;">â˜•</div>`}
          
          <div class="menu-card-content">
            <div class="menu-card-header">
              <div class="menu-card-title">${item.name}</div>
              <span class="menu-card-badge badge-${item.type || 'unknown'}">
                ${(item.type || 'unknown').toUpperCase()}
              </span>

            </div>
            
            <div class="menu-card-category">${item.category}</div>
            ${item.description ? `<div style="font-size: 13px; color: var(--text-light); margin-bottom: 10px;">${item.description}</div>` : ''}
            <div class="menu-card-price">â‚¹${item.price}</div>
            
            <div class="menu-card-stock">
              <span class="stock-indicator ${item.inStock ? 'in-stock' : 'out-of-stock'}"></span>
              <span>${item.inStock ? 'In Stock' : 'Out of Stock'}</span>
            </div>
            
            <div class="menu-card-actions">
              <button class="btn btn-primary btn-sm" onclick="editItem('${item.id}')">
                âœï¸ Edit
              </button>
              <button class="btn btn-danger btn-sm" onclick="deleteItem('${item.id}')">
                ğŸ—‘ï¸ Delete
              </button>
            </div>
          </div>
        </div>
      `).join('');
    }

    // Filter menu
    function filterMenu() {
      const searchTerm = document.getElementById('searchInput').value.toLowerCase();
      const filtered = menuItems.filter(item => 
        item.name.toLowerCase().includes(searchTerm) ||
        item.category.toLowerCase().includes(searchTerm) ||
        (item.description && item.description.toLowerCase().includes(searchTerm))
      );
      displayMenu(filtered);
    }

    // Open add modal
    function openAddModal() {
      editingItemId = null;
      document.getElementById('modalTitle').textContent = 'Add Menu Item';
      document.getElementById('menuForm').reset();
      document.getElementById('itemId').value = '';
      document.getElementById('menuModal').classList.add('active');
    }

    // Edit item
    function editItem(itemId) {
      const item = menuItems.find(i => i.id === itemId);
      if (!item) return;
      
      editingItemId = itemId;
      document.getElementById('modalTitle').textContent = 'Edit Menu Item';
      document.getElementById('itemId').value = item.id;
      document.getElementById('itemName').value = item.name;
      document.getElementById('itemCategory').value = item.category;
      document.getElementById('itemPrice').value = item.price;
      document.getElementById('itemDescription').value = item.description || '';
      document.getElementById('itemType').value = item.type;
      document.getElementById('itemInStock').value = item.inStock.toString();
      document.getElementById('itemImage').value = item.image || '';
      
      document.getElementById('menuModal').classList.add('active');
    }

    // Save menu item
    async function saveMenuItem(e) {
      e.preventDefault();
      
      const itemData = {
        name: document.getElementById('itemName').value,
        category: document.getElementById('itemCategory').value,
        price: parseInt(document.getElementById('itemPrice').value),
        description: document.getElementById('itemDescription').value,
        type: document.getElementById('itemType').value,
        inStock: document.getElementById('itemInStock').value === 'true',
        image: document.getElementById('itemImage').value
      };
      
      try {
        if (editingItemId) {
          // Update existing item
          await apiCall(`/menu/${editingItemId}`, 'PUT', itemData);
          showToast('Menu item updated successfully', 'success');
        } else {
          // Create new item
          await apiCall('/menu', 'POST', itemData);
          showToast('Menu item added successfully', 'success');
        }
        
        closeModal();
        await loadMenu();
      } catch (error) {
        console.error('Error saving menu item:', error);
        showToast('Failed to save menu item', 'error');
      }
    }

    // Delete item
    async function deleteItem(itemId) {
      if (!confirm('Are you sure you want to delete this item?')) return;
      
      try {
        await apiCall(`/menu/${itemId}`, 'DELETE');
        showToast('Menu item deleted successfully', 'success');
        await loadMenu();
      } catch (error) {
        console.error('Error deleting item:', error);
        showToast('Failed to delete menu item', 'error');
      }
    }

    // Close modal
    function closeModal() {
      document.getElementById('menuModal').classList.remove('active');
      document.getElementById('menuForm').reset();
    }

    // Toast notification
    function showToast(message, type) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => toast.classList.add('show'), 10);
      
      setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // Initialize
    loadMenu();
  </script>
</body>
</html>
